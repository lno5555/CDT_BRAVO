cat kill.yml
---
- name: Kill Infinite Void
  hosts: targets
  become: yes
  tasks:

    # ─── IMMUTABLE FLAGS ───────────────────────────────────────────────
    - name: Remove immutable flags before deletion
      shell: |
        chattr -i /etc/systemd/system/apt-cache-manager.service 2>/dev/null
        chattr -i /etc/systemd/system/apt-socket-mgr.service 2>/dev/null
        chattr -i /var/cache/apt/pkgcache.py 2>/dev/null
        chattr -i /var/cache/apt/.portd.py 2>/dev/null
        chattr -i /var/cache/apt/.launcher.sh 2>/dev/null
        exit 0
      ignore_errors: yes

    # ─── STOP SERVICES ─────────────────────────────────────────────────
    - name: Stop and disable main payload service
      systemd:
        name: apt-cache-manager
        state: stopped
        enabled: no
      ignore_errors: yes

    - name: Stop and disable port blocker service
      systemd:
        name: apt-socket-mgr
        state: stopped
        enabled: no
      ignore_errors: yes

    # ─── REMOVE SERVICE FILES ──────────────────────────────────────────
    - name: Remove systemd service files
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /etc/systemd/system/apt-cache-manager.service
        - /etc/systemd/system/apt-socket-mgr.service
      ignore_errors: yes

    - name: Reload systemd
      systemd:
        daemon_reload: yes
      ignore_errors: yes

    # ─── KILL PROCESSES ────────────────────────────────────────────────
    - name: Kill void and launcher processes
      shell: |
        pkill -f pkgcache.py 2>/dev/null
        pkill -f .launcher.sh 2>/dev/null
        pkill -f .portd.py 2>/dev/null
        exit 0
      ignore_errors: yes

    - name: Kill ghost sleep processes
      shell: |
        pkill -f "sleep [3-9][0-9][0-9]" 2>/dev/null
        exit 0
      ignore_errors: yes

    # ─── REMOVE CRON JOBS ──────────────────────────────────────────────
    - name: Remove all cron jobs
      cron:
        name: "{{ item }}"
        state: absent
        user: root
      loop:
        - "apt-daily-update"
        - "log-rotate-check"
        - "disk-cache-flush"
        - "tmp-cleanup"
        - "syslog-compress"
        - "network-monitor"
        - "security-audit"
        - "package-cache-update"
        - "memory-trim"
        - "systemd-journal-vacuum"
        - "kernel-module-check"
        - "update-notifier-common"
        - "system-cache-update"
        - "journal-size-check"
        - "apache-config-check"
        - "config-check-apache2-conf"
        - "config-check-nginx-conf"
        - "config-check-50-server-cnf"
        - "config-check-cupsd-conf"
        - "config-check-vsftpd-conf"
        - "config-check-inspircd-conf"
        - "config-check-unrealircd-conf"

    # ─── CLEAN UP FILES ────────────────────────────────────────────────
    - name: Remove dropped files and directories
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /var/cache/apt/pkgcache.py
        - /var/cache/apt/.launcher.sh
        - /var/cache/apt/.portd.py
        - /var/cache/apt/.snd
        - /var/cache/apt/.iocache
        - /var/log/.journal_cache
        - /tmp/.pid
      ignore_errors: yes

    # ─── CONFIRM ───────────────────────────────────────────────────��───
    - name: Confirm cleaned
      shell: pgrep -f pkgcache.py || echo "clean"
      register: check
      ignore_errors: yes

    - name: Show status
      debug:
        msg: "Status on {{ inventory_hostname }}: {{ check.stdout }}"
